<!-- index.html -->
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Cards</title>
		<script src="https://npmcdn.com/react@15.3.0/dist/react.js"></script>
		<script src="https://npmcdn.com/react-dom@15.3.0/dist/react-dom.js"></script>
		<script src="https://npmcdn.com/babel-core@5.8.38/browser.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js"></script>
		<script src="https://npmcdn.com/remarkable@1.6.2/dist/remarkable.min.js"></script>
		<link href="css/bootstrap.min.css" rel="stylesheet">

		<link rel="stylesheet" href="/css/base.css">
	</head>

	<body>
		<div id="content" class="col-md-12"</div>


		<script type="text/babel">
				var BoxRow = React.createClass ({
					getInitialState: function() {
							var hex = RandomHex();

              return {
                  cards: [
                    {id: 0, title: 'Card-1', hex: hex, rgb: ColorConverter(hex)},
									
                  ]  
              };
          },
          componentDidMount: function() {
             this.counter = 1;
          },

					_handleUpdate: function(id, newContent) {
						var cards = this.state.cards;
						var card = _.find(cards, {id : id});
						_.extend(card, newContent);
						this.setState({cards: cards});
					

					},

					_handleAdd: function() {
						var cards = this.state.cards;

						this.state.cardCount = this.state.cards.length + 1;
						var title = this.state.cardCount;
						var id = this.counter++;

						var hex = RandomHex();
						
						cards.push({id: id, title: "Card-" + title, hex: hex, rgb: ColorConverter(hex)});
						console.log(cards);

						this.setState({cards: cards});
					},
					_handleClear: function() {
						var cards = this.state.cards;
						var hex = RandomHex();


						this.state.cardCount = this.state.cards.length + 1;
						
						cards = [{title: "Card-1", hex: hex, rgb: ColorConverter(hex)}];

						this.setState({cards: cards});
					},
     
					render: function() {
						var that = this;
						return(
								<div className="boxRow col-md-10 col-md-offset-1">
								<div className="row">
									<button onClick={that._handleAdd}>Add</button>
									<button onClick={that._handleClear}>Clear</button>
								</div>
								{this.state.cards.map(function(card, key) {
									return <Box onUpdate={that._handleUpdate} card={card}  key={key}/> ;
                })}
									
								</div>
						);
					}
				});

				var Box = React.createClass ({
					_handleUpdate: function(index, content) {
						var card = this.props.card
						card[index] = content
						card.rgb =  ColorConverter(card.hex)
						this.props.onUpdate(card.id, card)
					},
					
					render: function() {
						var that = this
						return(
								<div  className="box">
									<BoxTitle onUpdate={function(newTitle){ that._handleUpdate("title", newTitle) }} title={this.props.card.title} />
									<BoxCard card={this.props.card} />
									<BoxInput onUpdate={function(newHex){ that._handleUpdate("hex", newHex) }} />
								</div>
						);
					}
				});

				var BoxTitle = React.createClass ({
					_handleChange: function(e){
						this.props.onUpdate(e.target.value);
						
					},
					render: function() {
						return(
								<input className="boxTitle" value={this.props.title} onChange={this._handleChange} maxLength="20" />
						);
					}
				});

				var BoxCard = React.createClass ({
					render: function() {
						var style = { backgroundColor: "#" + this.props.card.hex };

						return(
								<div className="boxCard" style={style}>
									<li>#{this.props.card.hex}</li>
									<li>{this.props.card.rgb}</li>
									
								</div>
						);
					}
				});

				var BoxInput = React.createClass ({
					handleInput: function(e) {
          	this.props.onUpdate(e.target.value);
          },
					render: function() {

						return(
								<input onChange={this.handleInput} maxLength="6"></input>
						);
					}
				});

				var ColorConverter = function(hex) {
          var r = parseInt(hex.substring(0,2), 16);
          var g = parseInt(hex.substring(2,4), 16);
          var b = parseInt(hex.substring(4,6), 16);

          var result = 'rgb('+r+','+g+','+b+')';
          var noResult = "No Valid RGB";
          if (result.search("NaN") === -1) {
            return result;
          } else {
            return noResult;
          }
       }

       var RandomHex = function() {
       		 var hex = "";
				   var characters = "abcdef0123456789";

				    for( var i=0; i < 6; i++ )
				        hex += characters.charAt(Math.floor(Math.random() * characters.length));

				    return hex;
       }

			 

			ReactDOM.render(
					<BoxRow />,
					document.getElementById('content')
				);

		</script>
	</body>
</html>

